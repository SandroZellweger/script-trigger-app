
SandroZellweger/script-trigger-app
main

GITHUB

add an extra buttono nemed zoko, connecting to zoko.html, here we will send messages to customers. okay?

I'll add a Zoko button to your Script Trigger home page that connects to zoko.html for sending messages to customers.


Untitled
Text 

Untitled
Text‚ÄÇ‚àô‚ÄÇVersion 2 
Perfect! I've added the Zoko button to your Script Trigger home page. Here's what I added:

New Zoko Menu Card: Added between Expenses and Settings with:
üí¨ Message icon
"Zoko" title
Description: "Send messages and communicate with customers"
Links to zoko.html
Updated Animation: Added animation delay for the 5th card so it appears smoothly with the others
The Zoko button will now appear in your menu grid and will redirect users to zoko.html where you can build your customer messaging interface. The button follows the same design pattern as your other menu items with the glassmorphism effect, hover animations, and ripple effects.




okay. now lets creat a zoko.html
basicly i have this function below in my google script.
i want a field to insert a phonenumber 
once click send it will send the phonnumber to my function and it will send the message to the insert number, make sense?

/**
 * Sends the Zoko WhatsApp template "how_to_book_new".
 *
 * ‚ö†Ô∏è  Fill in the values for {{1}}, {{2}}, ‚Ä¶ exactly as they appear
 *     in your Zoko template definition.  Delete any unused placeholders.
 *
 * @param {string} phoneNumber Recipient‚Äôs phone number in +41‚Ä¶ format
 * @param {...string} templateArgs Values to populate the template placeholders, in order
 * @return {boolean}            True on success, false on failure
 */
function sendHowToBookMessageApp(phoneNumber, ...templateArgs) {
  const url    = "https://chat.zoko.io/v2/message";
  const apiKey = "0a12096d-cfee-43e2-8360-b66d7b460cd3";   // TODO: store safely

  const payload = {
    channel:          "whatsapp",
    recipient:        phoneNumber,            // e.g. "+41781234567"
    type:             "template",
    templateId:       "how_to_book_new",      //  your template name 
    templateLanguage: "it",                   // or "en", "de", ‚Ä¶ as defined in Zoko
    templateArgs:     templateArgs            // ‚Üí values for {{1}}, {{2}}, ‚Ä¶
  };

  const options = {
    method:  "POST",
    headers: {
      "Accept":       "application/json",
      "Content-Type": "application/json",
      "apikey":       apiKey
    },
    payload: JSON.stringify(payload),
    muteHttpExceptions: true
  };

  try {
    const response     = UrlFetchApp.fetch(url, options);
    const code         = response.getResponseCode();
    const data         = JSON.parse(response.getContentText());

    if (code === 200) {
      Logger.log("Zoko how_to_book_new ‚ûú success: " + JSON.stringify(data));
      return true;
    } else {
      Logger.log("Zoko how_to_book_new ‚ûú HTTP " + code + ": " + JSON.stringify(data));
      return false;
    }
  } catch (e) {
    Logger.log("Zoko how_to_book_new ‚ûú exception: " + e.toString());
    return false;
  }
}

I'll create a zoko.html page that allows you to send WhatsApp messages through your Google Apps Script function. This will have a clean interface to input a phone number and send the "how_to_book_new" template.


Zoko WhatsApp Messaging
Interactive artifact 
Perfect! I've created the zoko.html page for sending WhatsApp messages through your Google Apps Script. Here's what the page includes:

Key Features:
Clean Interface:
Phone number input field with +41 prefix (Swiss format)
Template information showing it will send "How to Book New" template
Send button with loading states
Phone Number Handling:
Automatically formats Swiss numbers (+41 prefix)
Validates 9-digit input
Auto-focuses the input field
Integration with Your Script:
Calls your sendHowToBookMessageApp function
Sends the phone number in the correct format (+41xxxxxxxxx)
Includes your auth token and script URL
User Experience:
Loading spinner during message sending
Success/error status messages
Form validation and error handling
Responsive design matching your app's style
Visual Design:
Matches your existing glassmorphism theme
Smooth animations and transitions
Mobile-friendly responsive layout
Back button to return to home
How it works:
User enters a 9-digit Swiss phone number (e.g., 781234567)
System automatically adds +41 prefix
Clicks "Send Message"
Calls your Google Apps Script function with the formatted number
Shows success/error feedback
The page is ready to use with your existing Google Apps Script function. Just make sure your script can handle the JSON payload format being sent from the frontend!




‚ùå Network error. Please check your connection and try again.

The network error suggests there might be an issue with how we're calling your Google Apps Script. Let me fix the request format to match what your script expects.


Zoko WhatsApp Messaging
Interactive artifact‚ÄÇ‚àô‚ÄÇVersion 2 
I've updated the request to use GET method with URL parameters instead of POST with JSON body, which is more common for Google Apps Script web apps.

However, you'll also need to make sure your Google Apps Script can handle this function call. You'll need to add a handler in your script's doGet() function. Here's what you need to add to your Google Apps Script:

javascript
function doGet(e) {
  const func = e.parameter.function;
  const authToken = e.parameter.authToken;
  
  // Verify auth token
  if (authToken !== 'myAppToken2025') {
    return ContentService.createTextOutput(JSON.stringify({
      result: false,
      error: 'Invalid auth token'
    })).setMimeType(ContentService.MimeType.JSON);
  }
  
  try {
    let result;
    
    if (func === 'sendHowToBookMessageApp') {
      const phoneNumber = e.parameter.phoneNumber;
      result = sendHowToBookMessageApp(phoneNumber);
    } else if (func === 'ping') {
      result = { status: 'online' };
    } else {
      result = false;
    }
    
    return ContentService.createTextOutput(JSON.stringify({
      result: result
    })).setMimeType(ContentService.MimeType.JSON);
    
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      result: false,
      error: error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}
Add this doGet() function to your Google Apps Script, then redeploy the web app. This will allow the zoko.html page to properly call your sendHowToBookMessageApp function.

Try it again after adding this to your script!




does it metter if i have already a doget?
function doGet(e) {
  try {
    // Validate authentication
    const authToken = e.parameter.authToken;
    if (!validateAuthToken(authToken)) {
      return ContentService.createTextOutput(
        JSON.stringify({ error: "Unauthorized: Invalid auth token" })
      ).setMimeType(ContentService.MimeType.JSON)
        .setHeader('Access-Control-Allow-Origin', '*')
        .setHeader('Access-Control-Allow-Methods', 'GET')
        .setHeader('Access-Control-Allow-Headers', 'Content-Type');
    }

    const functionName = e.parameter.function;
    if (!functionName) {
      return ContentService.createTextOutput(
        JSON.stringify({ error: "No function specified" })
      ).setMimeType(ContentService.MimeType.JSON)
        .setHeader('Access-Control-Allow-Origin', '*')
        .setHeader('Access-Control-Allow-Methods', 'GET')
        .setHeader('Access-Control-Allow-Headers', 'Content-Type');
    }

    let result;
    switch (functionName) {
      case "triggerDailyReport":
        result = triggerDailyReport();
        break;
      case "triggerCustomDateReport":
        result = triggerCustomDateReport(e.parameter.customDateString);
        break;
      case "triggerHardcodedReport":
        result = triggerHardcodedReport();
        break;
      case "triggerStripePayment":
        result = triggerStripePayment(e.parameter.amount, e.parameter.description);
        break;
      case "ping":
        result = { result: "Ping successful" };
        break;
      case "getExpenses":
        result = getExpenses();
        break;
      case "logExpense":
        result = logExpenseGet(e);
        break;
      case "editExpense":
        result = editExpenseGet(e);
        break;
      case "deleteExpense":
        result = deleteExpense(e);
        break;
      default:
        result = { error: Unknown function: ${functionName} };
    }

    // Return JSON response with CORS headers
    const response = typeof result === "string" ? { result } : result;

    return ContentService.createTextOutput(JSON.stringify(response))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader('Access-Control-Allow-Origin', '*')
      .setHeader('Access-Control-Allow-Methods', 'GET')
      .setHeader('Access-Control-Allow-Headers', 'Content-Type');

  } catch (error) {
    const errorResponse = { error: error.toString() };
    return ContentService.createTextOutput(JSON.stringify(errorResponse))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader('Access-Control-Allow-Origin', '*')
      .setHeader('Access-Control-Allow-Methods', 'GET')
      .setHeader('Access-Control-Allow-Headers', 'Content-Type');
  }
}

adjust that one okay?

Perfect! You already have a well-structured doGet() function. I just need to add the Zoko case to your existing switch statement. Here's the updated version:

javascript
function doGet(e) {
  try {
    // Validate authentication
    const authToken = e.parameter.authToken;
    if (!validateAuthToken(authToken)) {
      return ContentService.createTextOutput(
        JSON.stringify({ error: "Unauthorized: Invalid auth token" })
      ).setMimeType(ContentService.MimeType.JSON)
        .setHeader('Access-Control-Allow-Origin', '*')
        .setHeader('Access-Control-Allow-Methods', 'GET')
        .setHeader('Access-Control-Allow-Headers', 'Content-Type');
    }

    const functionName = e.parameter.function;
    if (!functionName) {
      return ContentService.createTextOutput(
        JSON.stringify({ error: "No function specified" })
      ).setMimeType(ContentService.MimeType.JSON)
        .setHeader('Access-Control-Allow-Origin', '*')
        .setHeader('Access-Control-Allow-Methods', 'GET')
        .setHeader('Access-Control-Allow-Headers', 'Content-Type');
    }

    let result;
    switch (functionName) {
      case "triggerDailyReport":
        result = triggerDailyReport();
        break;
      case "triggerCustomDateReport":
        result = triggerCustomDateReport(e.parameter.customDateString);
        break;
      case "triggerHardcodedReport":
        result = triggerHardcodedReport();
        break;
      case "triggerStripePayment":
        result = triggerStripePayment(e.parameter.amount, e.parameter.description);
        break;
      case "sendHowToBookMessageApp":
        result = sendHowToBookMessageApp(e.parameter.phoneNumber);
        break;
      case "ping":
        result = { result: "Ping successful" };
        break;
      case "getExpenses":
        result = getExpenses();
        break;
      case "logExpense":
        result = logExpenseGet(e);
        break;
      case "editExpense":
        result = editExpenseGet(e);
        break;
      case "deleteExpense":
        result = deleteExpense(e);
        break;
      default:
        result = { error: `Unknown function: ${functionName}` };
    }

    // Return JSON response with CORS headers
    const response = typeof result === "string" ? { result } : result;
    
    return ContentService.createTextOutput(JSON.stringify(response))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader('Access-Control-Allow-Origin', '*')
      .setHeader('Access-Control-Allow-Methods', 'GET')
      .setHeader('Access-Control-Allow-Headers', 'Content-Type');
      
  } catch (error) {
    const errorResponse = { error: error.toString() };
    return ContentService.createTextOutput(JSON.stringify(errorResponse))
      .setMimeType(ContentService.MimeType.JSON)
      .setHeader('Access-Control-Allow-Origin', '*')
      .setHeader('Access-Control-Allow-Methods', 'GET')
      .setHeader('Access-Control-Allow-Headers', 'Content-Type');
  }
}
I only added this case to your switch statement:

javascript
case "sendHowToBookMessageApp":
  result = sendHowToBookMessageApp(e.parameter.phoneNumber);
  break;
After you add this case and redeploy your Google Apps Script web app, the zoko.html page should work perfectly! The function will receive the phone number parameter and call your sendHowToBookMessageApp function.




still have the same erro, can we add some loggs?

Yes! Let's add detailed logging to both the frontend and backend to see exactly what's happening. I'll update the zoko.html with more detailed logging first:


Zoko WhatsApp Messaging
Interactive artifact 
Now let's also add logging to your Google Apps Script. Here's the updated doGet() function with detailed logging:

javascript
function doGet(e) {
  try {
    console.log('üöÄ doGet called with parameters:', e.parameter);
    
    // Validate authentication
    const authToken = e.parameter.authToken;
    console.log('üîê Auth token received:', authToken);
    
    if (!validateAuthToken(authToken)) {
      console.log('‚ùå Auth validation failed');
      return ContentService.createTextOutput(
        JSON.stringify({ error: "Unauthorized: Invalid auth token" })
      ).setMimeType(ContentService.MimeType.JSON)
        .setHeader('Access-Control-Allow-Origin', '*')
        .setHeader('Access-Control-Allow-Methods', 'GET')
        .setHeader('Access-Control-Allow-Headers', 'Content-Type');
    }
    
    console.log('‚úÖ Auth validation passed');

    const functionName = e.parameter.function;
    console.log('üéØ Function requested:', functionName);
    
    if (!functionName) {
      console.log('‚ùå No function specified');
      return ContentService.createTextOutput(
        JSON.stringify({ error: "No function specified" })
      ).setMimeType(ContentService.MimeType.JSON)
        .setHeader('Access-Control-Allow-Origin', '*')
        .setHeader('Access-Control-Allow-Methods', 'GET')
        .setHeader('Access-Control-Allow-Headers', 'Content-Type');
    }

    let result;
    switch (functionName) {
      case "triggerDaily




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Zoko Messages">
    <title>Zoko - WhatsApp Messages</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            color: #333;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            width: 100%;
            margin-top: 20px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #333;
        }

        .header p {
            font-size: 16px;
            opacity: 0.8;
            color: #555;
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            text-decoration: none;
            color: #333;
            font-weight: 500;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .message-form {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            background: #fff;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .phone-input {
            position: relative;
        }

        .phone-prefix {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-weight: 500;
            pointer-events: none;
        }

        .form-input.with-prefix {
            padding-left: 50px;
        }

        .send-button {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .send-button:active {
            transform: translateY(0);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .status-message {
            margin-top: 20px;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            font-weight: 500;
            display: none;
        }

        .status-success {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .status-error {
            background: rgba(244, 67, 54, 0.1);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .template-info {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            width: 100%;
        }

        .template-info h3 {
            color: #f57c00;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .template-info p {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                padding: 20px;
                margin-top: 60px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .message-form {
                padding: 25px;
            }
        }

        /* Fade in animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeInUp 0.6s ease-out forwards;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">
        <span>‚Üê</span>
        Back to Home
    </a>

    <div class="container">
        <div class="header animate-in">
            <h1>üí¨ Zoko Messaging</h1>
            <p>Send WhatsApp messages to customers</p>
        </div>

        <div class="template-info animate-in">
            <h3>üìã Template: "How to Book New"</h3>
            <p>This will send the predefined booking instructions template to the customer's WhatsApp number.</p>
        </div>

        <div class="message-form animate-in">
            <form id="messageForm">
                <div class="form-group">
                    <label for="phoneNumber" class="form-label">Customer Phone Number</label>
                    <div class="phone-input">
                        <span class="phone-prefix">+41</span>
                        <input 
                            type="tel" 
                            id="phoneNumber" 
                            name="phoneNumber"
                            class="form-input with-prefix" 
                            placeholder="781234567"
                            required
                            pattern="[0-9]{9}"
                            title="Please enter a 9-digit Swiss phone number"
                        >
                    </div>
                    <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                        Enter Swiss phone number without +41 (e.g., 781234567)
                    </small>
                </div>

                <button type="submit" class="send-button" id="sendButton">
                    <span id="buttonText">Send Message</span>
                    <span id="buttonSpinner" class="spinner" style="display: none;"></span>
                </button>
            </form>

            <div id="statusMessage" class="status-message"></div>
        </div>
    </div>

    <script>
        const form = document.getElementById('messageForm');
        const phoneInput = document.getElementById('phoneNumber');
        const sendButton = document.getElementById('sendButton');
        const buttonText = document.getElementById('buttonText');
        const buttonSpinner = document.getElementById('buttonSpinner');
        const statusMessage = document.getElementById('statusMessage');

        // Google Apps Script URL
        const scriptUrl = "https://script.google.com/macros/s/AKfycbwfWSjTE8g0dK5keWeDsUwFjPBgmk8NLy8bpJJm05h091HJgCNoxVeJnPrF3oSG-u62vw/exec";

        // Format phone number as user types
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
            if (value.length > 9) {
                value = value.slice(0, 9); // Limit to 9 digits
            }
            e.target.value = value;
        });

        // Handle form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const phoneNumber = phoneInput.value.trim();
            
            if (!phoneNumber || phoneNumber.length !== 9) {
                showStatus('Please enter a valid 9-digit phone number', 'error');
                return;
            }

            // Format phone number with +41 prefix
            const fullPhoneNumber = `+41${phoneNumber}`;
            
            // Show loading state
            setLoading(true);
            hideStatus();

            try {
                // Call the Google Apps Script function using URL parameters
                const params = new URLSearchParams({
                    function: 'sendHowToBookMessageApp',
                    authToken: 'myAppToken2025',
                    phoneNumber: fullPhoneNumber
                });

                const requestUrl = `${scriptUrl}?${params.toString()}`;
                console.log('üöÄ Making request to:', requestUrl);
                console.log('üì± Phone number:', fullPhoneNumber);

                const response = await fetch(requestUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    }
                });

                console.log('üì° Response status:', response.status);
                console.log('üì° Response headers:', Object.fromEntries(response.headers.entries()));

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const responseText = await response.text();
                console.log('üìÑ Raw response:', responseText);

                let data;
                try {
                    data = JSON.parse(responseText);
                    console.log('‚úÖ Parsed response:', data);
                } catch (parseError) {
                    console.error('‚ùå JSON parse error:', parseError);
                    throw new Error(`Invalid JSON response: ${responseText}`);
                }
                
                if (data.result === true) {
                    showStatus(`‚úÖ Message sent successfully to ${fullPhoneNumber}`, 'success');
                    form.reset(); // Clear the form
                } else if (data.error) {
                    showStatus(`‚ùå Failed to send message: ${data.error}`, 'error');
                } else {
                    showStatus(`‚ùå Failed to send message: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                console.error('‚ùå Full error details:', error);
                console.error('‚ùå Error name:', error.name);
                console.error('‚ùå Error message:', error.message);
                console.error('‚ùå Error stack:', error.stack);
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                setLoading(false);
            }
        });

        function setLoading(loading) {
            sendButton.disabled = loading;
            if (loading) {
                buttonText.style.display = 'none';
                buttonSpinner.style.display = 'block';
            } else {
                buttonText.style.display = 'block';
                buttonSpinner.style.display = 'none';
            }
        }

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message status-${type}`;
            statusMessage.style.display = 'block';
            
            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    hideStatus();
                }, 5000);
            }
        }

        function hideStatus() {
            statusMessage.style.display = 'none';
        }

        // Auto-focus phone input
        phoneInput.focus();
    </script>
</body>
</html>
