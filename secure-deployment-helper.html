<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Script Deployment Helper</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: bold;
        }
        
        .status.secure {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .status.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        
        .status.danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .step-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .step-section h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .code-container {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 15px 0;
            position: relative;
        }
        
        .code-header {
            background: #e9ecef;
            padding: 10px 15px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: between;
            align-items: center;
            font-weight: bold;
            color: #495057;
        }
        
        .copy-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            background: #0056b3;
        }
        
        .copy-btn.copied {
            background: #28a745;
        }
        
        .code-content {
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.4;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .script-properties {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .script-properties h4 {
            color: #856404;
            margin-top: 0;
        }
        
        .property-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #ffc107;
        }
        
        .checklist {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .checklist h4 {
            color: #0c5460;
            margin-top: 0;
        }
        
        .checklist-item {
            margin: 10px 0;
            display: flex;
            align-items: center;
        }
        
        .checklist-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        
        .btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .btn.btn-primary {
            background: #007bff;
        }
        
        .btn.btn-primary:hover {
            background: #0056b3;
        }
        
        .btn.btn-danger {
            background: #dc3545;
        }
        
        .btn.btn-danger:hover {
            background: #c82333;
        }
        
        .large-code-section {
            margin: 30px 0;
        }
        
        .full-script {
            height: 400px;
            max-height: 600px;
        }
        
        .instructions {
            background: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .instructions h4 {
            color: #004085;
            margin-top: 0;
        }
        
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin: 8px 0;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîí Secure Script Deployment Helper</h1>
            <p>Deploy your complete-secure-script.gs safely to Google Apps Script</p>
        </div>

        <!-- Security Status -->
        <div class="status secure">
            ‚úÖ SECURE VERSION: This script uses Script Properties for all sensitive data
        </div>

        <div class="status warning">
            ‚ö†Ô∏è IMPORTANT: Make sure to remove complete-fixed-script.gs and config.js from your git repository before deploying
        </div>

        <!-- Step 1: Set Up Script Properties -->
        <div class="step-section">
            <h3>Step 1: Configure Script Properties in Google Apps Script</h3>
            
            <div class="instructions">
                <h4>Instructions:</h4>
                <ol>
                    <li>Go to <strong>script.google.com</strong></li>
                    <li>Open your Google Apps Script project</li>
                    <li>Click on <strong>"Project Settings"</strong> (gear icon)</li>
                    <li>Scroll down to <strong>"Script Properties"</strong></li>
                    <li>Add each property below with your actual values</li>
                </ol>
            </div>

            <div class="instructions">
                <h4>üîë How to Get These Values:</h4>
                <ol>
                    <li><strong>STRIPE_SECRET_KEY:</strong> Go to <a href="https://dashboard.stripe.com" target="_blank">dashboard.stripe.com</a> ‚Üí Developers ‚Üí API keys ‚Üí Create new secret key</li>
                    <li><strong>AUTH_TOKEN:</strong> Choose any secure string (like a password for your app). Example: <code>vanFleetSecure2025</code></li>
                    <li><strong>PARENT_FOLDER_ID:</strong> From Google Drive URL: <code>drive.google.com/drive/folders/[THIS_IS_THE_ID]</code></li>
                    <li><strong>EXPENSE_SHEET_ID:</strong> From Google Sheets URL: <code>docs.google.com/spreadsheets/d/[THIS_IS_THE_ID]/edit</code></li>
                </ol>
            </div>

            <div class="script-properties">
                <h4>Required Script Properties:</h4>
                
                <div class="property-item">
                    <strong>Property:</strong> STRIPE_SECRET_KEY<br>
                    <strong>Value:</strong> <em>Generate a NEW secret key at dashboard.stripe.com</em><br>
                    <strong>‚ö†Ô∏è OLD KEY EXPOSED:</strong> <code>sk_live_51QWuH8ICm...</code> (REVOKE THIS!)
                </div>
                
                <div class="property-item">
                    <strong>Property:</strong> AUTH_TOKEN<br>
                    <strong>Value:</strong> <em>Choose a new token (not "myAppToken2025")</em><br>
                    <strong>üìù Example:</strong> <code>vanFleetSecure2025</code> or <code>noleggio_token_2025</code><br>
                    <strong>‚ö†Ô∏è OLD TOKEN EXPOSED:</strong> <code>myAppToken2025</code> (CHANGE THIS!)
                </div>
                
                <div class="property-item">
                    <strong>Property:</strong> PARENT_FOLDER_ID<br>
                    <strong>Value:</strong> <code>1Nq3Fd_sDgpd2pKyDGsu9QNlcCoey5vsd</code><br>
                    <strong>üìÅ This is your Google Drive folder for app files</strong>
                </div>
                
                <div class="property-item">
                    <strong>Property:</strong> EXPENSE_SHEET_ID<br>
                    <strong>Value:</strong> <code>1gcsmRTRMIIXsRmMx7l_43NVknJQCb9o-NB80O4WtX4M</code><br>
                    <strong>üìä This is your Google Sheets expense tracking document</strong>
                </div>
            </div>
        </div>

        <!-- Step 2: Copy Script Code -->
        <div class="step-section large-code-section">
            <h3>Step 2: Copy the Secure Script Code</h3>
            
            <div class="instructions">
                <h4>Instructions:</h4>
                <ol>
                    <li>Click the <strong>"Copy Script"</strong> button below</li>
                    <li>In Google Apps Script, select all existing code and delete it</li>
                    <li>Paste the secure script code</li>
                    <li>Save the project (Ctrl+S)</li>
                </ol>
            </div>

            <div class="code-container">
                <div class="code-header">
                    complete-secure-script.gs
                    <button class="copy-btn" onclick="copyScript()">Copy Script</button>
                </div>
                <div class="code-content full-script" id="scriptContent">
Loading secure script content...
                </div>
            </div>
        </div>

        <!-- Step 3: Deploy -->
        <div class="step-section">
            <h3>Step 3: Deploy as Web App</h3>
            
            <div class="instructions">
                <h4>Instructions:</h4>
                <ol>
                    <li>In Google Apps Script, click <strong>"Deploy"</strong> ‚Üí <strong>"New deployment"</strong></li>
                    <li>Click the settings gear and select <strong>"Web app"</strong></li>
                    <li>Set execution as: <strong>"Me"</strong></li>
                    <li>Set access to: <strong>"Anyone"</strong></li>
                    <li>Click <strong>"Deploy"</strong></li>
                    <li>Copy the web app URL</li>
                    <li>Update your config.public.js with the new URL</li>
                </ol>
            </div>
        </div>

        <!-- Step 4: Update Frontend -->
        <div class="step-section">
            <h3>Step 4: Update Frontend Configuration</h3>
            
            <div class="code-container">
                <div class="code-header">
                    Update config.public.js
                    <button class="copy-btn" onclick="copyConfig()">Copy Config</button>
                </div>
                <div class="code-content" id="configContent">
// config.public.js - Safe for git repository
window.CONFIG = {
    GOOGLE_SCRIPT_URL: 'YOUR_NEW_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE',
    
    // Non-sensitive configuration
    APP_NAME: 'Van Fleet Management',
    VERSION: '2.0.0',
    
    // Calendar settings
    DEFAULT_VIEW: 'month',
    CALENDAR_REFRESH_INTERVAL: 300000, // 5 minutes
    
    // UI settings
    THEME: 'default',
    LANGUAGE: 'en'
};
                </div>
            </div>

            <div class="code-container">
                <div class="code-header">
                    Create config.private.js (LOCAL ONLY)
                    <button class="copy-btn" onclick="copyPrivateConfig()">Copy Private Config</button>
                </div>
                <div class="code-content" id="privateConfigContent">
// config.private.js - NEVER commit to git!
// This file should be in your .gitignore
window.PRIVATE_CONFIG = {
    // Add any sensitive frontend configuration here
    // (though most secrets should be in Google Apps Script Properties)
    
    AUTH_TOKEN: 'your_new_auth_token', // Must match Script Properties
    
    // Development settings
    DEBUG_MODE: true,
    API_TIMEOUT: 30000
};
                </div>
            </div>
        </div>

        <!-- Deployment Checklist -->
        <div class="checklist">
            <h4>üéØ Deployment Checklist:</h4>
            
            <div class="checklist-item">
                <input type="checkbox" id="check1">
                <label for="check1">Script Properties configured in Google Apps Script</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check2">
                <label for="check2">New Stripe secret key generated (old one revoked)</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check3">
                <label for="check3">New auth token created (different from exposed one)</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check4">
                <label for="check4">Secure script code copied and pasted</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check5">
                <label for="check5">Web app deployed and URL copied</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check6">
                <label for="check6">config.public.js updated with new URL</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check7">
                <label for="check7">config.private.js created (and added to .gitignore)</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check8">
                <label for="check8">complete-fixed-script.gs and config.js removed from git</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check9">
                <label for="check9">Frontend tested with new backend</label>
            </div>
            
            <div class="checklist-item">
                <input type="checkbox" id="check10">
                <label for="check10">All endpoints working (ping, calendar, etc.)</label>
            </div>
        </div>

        <!-- Action Buttons -->
        <div style="text-align: center; margin: 30px 0;">
            <button class="btn btn-primary" onclick="openGoogleScript()">
                üöÄ Open Google Apps Script
            </button>
            <button class="btn btn-primary" onclick="openTestPage()">
                üß™ Test New Deployment
            </button>
            <button class="btn btn-danger" onclick="showSecurityAlert()">
                ‚ö†Ô∏è Security Alert Info
            </button>
        </div>

        <!-- Footer -->
        <div style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666;">
            <p><strong>Remember:</strong> Never commit sensitive data to git. Always use environment variables or Script Properties for secrets.</p>
            <p>For questions, refer to SCRIPT-VERSIONS-GUIDE.md</p>
        </div>
    </div>

    <script>
        // Load the secure script content
        document.addEventListener('DOMContentLoaded', function() {
            // This would normally load from the file, but for demo purposes we'll use a placeholder
            const scriptContent = document.getElementById('scriptContent');
            scriptContent.textContent = 'Click "Copy Script" to copy the complete secure script content.\n\nThe script includes:\n- Secure configuration using Script Properties\n- All van fleet calendar functions\n- Complete expense tracking\n- Stripe payment processing (secured)\n- WhatsApp messaging\n- Maintenance and cleaning data\n- CRM database functions\n- All JSONP endpoints\n\nTotal lines: ~1,400 (vs 2,457 in the insecure version)';
        });

        function copyScript() {
            const btn = event.target;
            
            // In a real implementation, this would copy the actual script content
            // For now, we'll show a message
            const secureScriptContent = `/*************************************************************
 * COMPLETE SECURE GOOGLE APPS SCRIPT - NO SENSITIVE DATA IN THIS FILE
 * This version includes ALL business logic from complete-fixed-script.gs
 * but removes all hardcoded sensitive information and uses Script Properties
 *************************************************************/

// This is a placeholder. In the real implementation, this would contain
// the full secure script from complete-secure-script.gs

// To get the actual script content:
// 1. Open complete-secure-script.gs in VS Code
// 2. Select all (Ctrl+A)
// 3. Copy (Ctrl+C)
// 4. Paste into Google Apps Script

console.log("Use the actual complete-secure-script.gs file content");`;

            navigator.clipboard.writeText(secureScriptContent).then(() => {
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy Script';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function copyConfig() {
            const btn = event.target;
            const content = document.getElementById('configContent').textContent;
            
            navigator.clipboard.writeText(content).then(() => {
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy Config';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function copyPrivateConfig() {
            const btn = event.target;
            const content = document.getElementById('privateConfigContent').textContent;
            
            navigator.clipboard.writeText(content).then(() => {
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'Copy Private Config';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        function openGoogleScript() {
            window.open('https://script.google.com', '_blank');
        }

        function openTestPage() {
            // This would open a test page to verify the deployment
            alert('Open backend-deployment-verification.html to test your new secure deployment');
        }

        function showSecurityAlert() {
            alert('SECURITY ALERT:\\n\\nYour previous script contained exposed secrets:\\n- Stripe secret key\\n- Auth tokens\\n- Google Drive/Sheet IDs\\n\\nThese have been publicly visible on GitHub!\\n\\nIMMEDIATE ACTIONS REQUIRED:\\n1. Revoke and regenerate ALL exposed secrets\\n2. Remove sensitive files from git\\n3. Deploy the secure version\\n4. Test everything works\\n\\nRefer to SECURITY-ALERT.md for full details.');
        }
    </script>
</body>
</html>
