<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="description" content="Script Trigger - Van rental management, reports, payments, and fleet calendar">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Script Trigger">
    <meta name="theme-color" content="#7DBB35">
    <title>Script Trigger - Home</title>
    
    <!-- Preconnect only to fonts.gstatic.com (actual font files) -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Non-blocking font load -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"></noscript>
    
    <style>
        /* Font fallback to reduce CLS */
        @font-face {
            font-family: 'Roboto-Fallback';
            src: local('Arial');
            ascent-override: 92.77%;
            descent-override: 24.41%;
            size-adjust: 100.16%;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', 'Roboto-Fallback', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #7DBB35 0%, #5a8827 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }

        .container {
            max-width: 100%;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: #FFFFFF;
            border-radius: 20px;
            color: #333;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            width: 100%;
            max-width: 400px;
            position: relative;
        }

        .admin-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;  /* Optimized transition */
            display: flex;
            align-items: center;
            gap: 5px;
            border: none;  /* Reset button border */
            font-family: inherit;
        }

        .admin-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .admin-badge.logged-in {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .header img.logo {
            max-height: 60px;
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #333;
        }

        .header p {
            font-size: 16px;
            opacity: 0.8;
            color: #555;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 800px;
            margin-bottom: 30px;
        }        .menu-card {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            border: 2px solid transparent;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            border-color: #7DBB35;
        }

        .menu-card:active {
            transform: translateY(-2px);
        }

        .menu-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        .menu-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .menu-description {
            font-size: 14px;
            color: #444;  /* Improved contrast from #666 to #444 (4.5:1 ratio) */
            line-height: 1.4;
        }
        
        /* Visually hidden but accessible to screen readers */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .status-bar {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 15px 20px;
            width: 100%;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .status-item {
            display: inline-block;
            margin: 0 15px;
            font-size: 14px;
            color: #333;  /* Improved contrast from #555 to #333 */
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .online {
            background: #4CAF50;
        }

        .version {
            color: #555;  /* Improved contrast from #888 to #555 */
            font-size: 12px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                padding: 20px;
                margin-bottom: 30px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .menu-card {
                padding: 25px;
            }
            
            .menu-icon {
                font-size: 40px;
            }
            
            .menu-title {
                font-size: 18px;
            }
        }

        /* Fade in animation - GPU composited, minimal delay */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translate3d(0, 20px, 0);
            }
            to {
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }

        .animate-in {
            animation: fadeInUp 0.3s ease-out forwards;
        }
        
        /* No staggered delays - all animate together for faster perceived load */
        
        /* Reduce motion for users who prefer it */
        @media (prefers-reduced-motion: reduce) {
            .animate-in {
                animation: none;
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <main class="container" role="main">
        <header class="header animate-in">
            <button class="admin-badge" id="adminBadge" onclick="handleAdminClick()" aria-label="Admin login" type="button">
                <span id="adminIcon" aria-hidden="true">üîê</span>
                <span id="adminText">Admin</span>
            </button>
            <h1 class="visually-hidden">Script Trigger - Van Fleet Management</h1>
            <img src="logo-small.jpg" 
                 alt="Noleggio Semplice - Van Rental Company Logo" 
                 class="logo" 
                 width="200" 
                 height="60"
                 fetchpriority="high"
                 decoding="async">
        </header>

        <nav class="menu-grid" aria-label="Main navigation">
            <a href="reports.html" class="menu-card animate-in">
                <span class="menu-icon" aria-hidden="true">üìä</span>
                <span class="menu-title">Reports</span>
                <span class="menu-description">Generate daily reports, custom date reports, and analytics</span>
            </a>

            <a href="payments.html" class="menu-card animate-in">
                <span class="menu-icon" aria-hidden="true">üí≥</span>
                <span class="menu-title">Payments</span>
                <span class="menu-description">Create Stripe payment links and manage transactions</span>
            </a>

            <a href="expenses.html" class="menu-card animate-in">
                <span class="menu-icon" aria-hidden="true">üí∞</span>
                <span class="menu-title">Expenses</span>
                <span class="menu-description">Track business expenses and upload receipts</span>
            </a>

            <a href="calendar-production.html" class="menu-card animate-in">
                <span class="menu-icon" aria-hidden="true">üìÖ</span>
                <span class="menu-title">Calendar & CRM</span>
                <span class="menu-description">View van rental bookings and customer management</span>
            </a>

            <a href="zoko.html" class="menu-card animate-in">
                <span class="menu-icon" aria-hidden="true">üí¨</span>
                <span class="menu-title">Zoko</span>
                <span class="menu-description">Send messages and communicate with customers</span>
            </a>
            
            <a href="maintenance.html" class="menu-card animate-in">
                <span class="menu-icon" aria-hidden="true">üîß</span>
                <span class="menu-title">Maintenance</span>
                <span class="menu-description">Track vehicle maintenance and service records</span>
            </a>
            
            <a href="maintenance-new.html#cleaning" class="menu-card animate-in">
                <span class="menu-icon" aria-hidden="true">üßπ</span>
                <span class="menu-title">Van Cleaning</span>
                <span class="menu-description">Schedule and track van cleaning activities</span>
            </a>
            
            <a href="foto.html" class="menu-card animate-in">
                <span class="menu-icon" aria-hidden="true">üì∏</span>
                <span class="menu-title">Foto</span>
                <span class="menu-description">Upload photos to Google Drive</span>
            </a>
            
            <a href="settings.html" class="menu-card animate-in">
                <span class="menu-icon" aria-hidden="true">‚öôÔ∏è</span>
                <span class="menu-title">Settings</span>
                <span class="menu-description">App configuration and script management</span>
            </a>
        </nav>

        <!-- Admin Section - Solo visibile se loggato -->
        <section id="adminSection" style="display: none; width: 100%; max-width: 800px; margin-top: 20px;" aria-label="Admin area">
            <h2 style="color: white; text-align: center; margin-bottom: 20px; font-size: 24px;">
                <span aria-hidden="true">üîê</span> Area Admin
            </h2>
            <nav class="menu-grid" aria-label="Admin navigation">
                <a href="maintenance-new.html#damage-ai" class="menu-card animate-in" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <span class="menu-icon" aria-hidden="true">ü§ñ</span>
                    <span class="menu-title">AI Damage Recognition</span>
                    <span class="menu-description">Analyze damage photos with AI</span>
                </a>

                <a href="maintenance-new.html" class="menu-card animate-in" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <span class="menu-icon" aria-hidden="true">üîß</span>
                    <span class="menu-title">Manutenzione Veicoli</span>
                    <span class="menu-description">Sistema di tracciamento difetti e riparazioni</span>
                </a>

                <a href="admin.html" class="menu-card animate-in" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <span class="menu-icon" aria-hidden="true">üìä</span>
                    <span class="menu-title">Admin Dashboard</span>
                    <span class="menu-description">Full admin control panel</span>
                </a>
            </nav>
        </section>

        <footer class="status-bar animate-in" role="contentinfo">
            <div class="status-item" role="status">
                <span class="status-indicator online" aria-hidden="true"></span>
                <span>Online</span>
            </div>
            <div class="status-item" role="status">
                <span class="status-indicator online" aria-hidden="true"></span>
                <span>Scripts Ready</span>
            </div>
            <div class="status-item version" id="app-version" aria-label="App version">
                Loading version‚Ä¶
            </div>
        </footer>
    </main>    
    
    <!-- Defer all scripts to not block rendering -->
    <script src="config.private.js" defer></script>
    <script src="config.public.js" defer></script>
    
    <script defer>
        // Update version badge once config loads
        function updateVersionBadge() {
            const versionEl = document.getElementById('app-version');
            if (versionEl && window.APP_CONFIG && window.APP_CONFIG.version) {
                versionEl.textContent = `v${window.APP_CONFIG.version}`;
            }
        }

        // Function to get settings (now uses centralized config)
        function getSettings() {
            // Use centralized config as default, allow localStorage overrides
            const defaultSettings = {
                scriptUrl: window.APP_CONFIG.scriptUrl,
                authToken: window.APP_CONFIG.authToken
            };
            
            const savedSettings = localStorage.getItem('appSettings');
            return savedSettings ? { ...defaultSettings, ...JSON.parse(savedSettings) } : defaultSettings;
        }

        // Admin utenti
        const ADMIN_USERS = {
            'Alessandro': '050187',
            'Sandro': '191284'
        };

        // Controlla se admin loggato
        function checkAdminStatus() {
            const adminUser = localStorage.getItem('adminUser');
            const adminToken = localStorage.getItem('adminToken');
            
            if (adminUser && adminToken) {
                // Verifica token valido
                const expectedToken = btoa(adminUser + ':' + ADMIN_USERS[adminUser]);
                if (adminToken === expectedToken) {
                    showAdminSection(adminUser);
                    return true;
                }
            }
            return false;
        }

        // Mostra sezione admin
        function showAdminSection(username) {
            document.getElementById('adminSection').style.display = 'block';
            const badge = document.getElementById('adminBadge');
            badge.classList.add('logged-in');
            document.getElementById('adminIcon').textContent = 'üë§';
            document.getElementById('adminText').textContent = username;
        }

        // Nascondi sezione admin
        function hideAdminSection() {
            document.getElementById('adminSection').style.display = 'none';
            const badge = document.getElementById('adminBadge');
            badge.classList.remove('logged-in');
            document.getElementById('adminIcon').textContent = 'üîê';
            document.getElementById('adminText').textContent = 'Admin';
        }

        // Handle click su badge admin
        function handleAdminClick() {
            const adminUser = localStorage.getItem('adminUser');
            
            if (adminUser) {
                // Gi√† loggato - chiedi conferma logout
                if (confirm('Vuoi uscire dall\'area admin?')) {
                    localStorage.removeItem('adminUser');
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('adminLoginTime');
                    hideAdminSection();
                    alert('Logout effettuato con successo');
                }
            } else {
                // Non loggato - mostra prompt login
                showAdminLogin();
            }
        }

        // Mostra prompt login admin
        function showAdminLogin() {
            const username = prompt('Inserisci username Admin:');
            if (!username) return;
            
            const password = prompt('Inserisci password:');
            if (!password) return;
            
            // Verifica credenziali
            if (ADMIN_USERS[username] && ADMIN_USERS[username] === password) {
                const token = btoa(username + ':' + password);
                localStorage.setItem('adminUser', username);
                localStorage.setItem('adminToken', token);
                localStorage.setItem('adminLoginTime', new Date().toISOString());
                
                showAdminSection(username);
                alert('‚úÖ Login effettuato! Ora puoi accedere alle funzioni admin.');
            } else {
                alert('‚ùå Username o password non corretti');
            }
        }

        // Check script status on load - optimized for performance
        document.addEventListener('DOMContentLoaded', () => {
            // Update version badge immediately
            updateVersionBadge();
            requestAnimationFrame(() => {
                setTimeout(updateVersionBadge, 100);
            });
            
            // Check admin status (fast, local operation)
            checkAdminStatus();
            
            // Defer non-critical network check to after page is interactive
            if ('requestIdleCallback' in window) {
                requestIdleCallback(() => pingScript(), { timeout: 3000 });
            } else {
                setTimeout(pingScript, 1500);
            }
        });
        
        // Separated ping function to reduce main thread blocking
        async function pingScript() {
            try {
                const settings = getSettings();
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(
                    `${settings.scriptUrl}?function=ping&authToken=${settings.authToken}`,
                    { signal: controller.signal }
                );
                clearTimeout(timeoutId);
                
                const data = await response.json();
                console.log(data.result ? '‚úÖ Google Apps Script is online' : '‚ö†Ô∏è Google Apps Script might be offline');
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.log('‚ö†Ô∏è Could not reach Google Apps Script');
                }
            }
        }

        // Add ripple effect to cards - deferred and optimized
        requestAnimationFrame(() => {
            // Add ripple animation CSS once
            const style = document.createElement('style');
            style.textContent = `
                @keyframes ripple {
                    to {
                        transform: scale(4);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
            
            // Use event delegation instead of individual listeners
            document.querySelector('.menu-grid')?.addEventListener('click', function(e) {
                const card = e.target.closest('.menu-card');
                if (!card) return;
                
                const ripple = document.createElement('div');
                const rect = card.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    border-radius: 50%;
                    background: rgba(125, 187, 53, 0.3);
                    transform: scale(0);
                    animation: ripple 0.6s linear;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                    pointer-events: none;
                `;
                
                card.style.position = 'relative';
                card.style.overflow = 'hidden';
                card.appendChild(ripple);
                
                setTimeout(() => ripple.remove(), 600);
            });
        });
    </script>
</body>
</html>
